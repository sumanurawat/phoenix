<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title or 'Dashboard' }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        
        .dashboard-container {
            display: flex;
            height: 100vh;
        }
        
        .dashboard-sidebar {
            width: 30%;
            background: white;
            border-right: 1px solid #e9ecef;
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .dashboard-main {
            width: 70%;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .sidebar-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        
        .sidebar-subtitle {
            color: #6c757d;
            font-size: 0.9rem;
            margin: 0;
        }
        
        .dashboard-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .dashboard-item {
            margin-bottom: 0.5rem;
        }
        
        .dashboard-link {
            display: block;
            padding: 1rem;
            text-decoration: none;
            color: #495057;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .dashboard-link:hover {
            background-color: #f8f9fa;
            color: #007bff;
            text-decoration: none;
        }
        
        .dashboard-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .dashboard-link .dashboard-icon {
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }
        
        .dashboard-link .dashboard-name {
            font-weight: 500;
            font-size: 1rem;
        }
        
        .dashboard-link .dashboard-desc {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 0.25rem;
        }
        
        .dashboard-link .dashboard-meta {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.5rem;
        }
        
        .main-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .main-title {
            font-size: 2rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        
        .main-subtitle {
            color: #6c757d;
            margin: 0.5rem 0 0 0;
        }
        
        .dashboard-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 2rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #007bff;
            margin: 0;
        }
        
        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin: 0.5rem 0 0 0;
        }
        
        .back-btn {
            margin-bottom: 1rem;
        }
        
        .create-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #007bff;
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 16px rgba(0,123,255,0.3);
            transition: all 0.2s ease;
        }
        
        .create-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
                height: auto;
            }
            
            .dashboard-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .dashboard-main {
                width: 100%;
            }
        }
        
        /* Modal Styles */
        .creation-step {
            display: none;
        }
        
        .creation-step.active {
            display: block;
        }
        
        .dataset-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .dataset-item {
            border: 1px solid #e9ecef;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }
        
        .dataset-item:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.1);
        }
        
        .dataset-item.selected {
            border-color: #007bff;
            background-color: rgba(0,123,255,0.05);
        }
        
        .dataset-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        .dataset-source {
            font-size: 0.85rem;
            color: #007bff;
            margin-bottom: 0.5rem;
        }
        
        .dataset-description {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .dataset-meta {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .dataset-checkbox {
            float: right;
            margin-top: -2rem;
        }
        
        .search-status {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
            background-color: #f8f9fa;
        }
        
        .search-status.completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .progress-step {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .progress-step.active {
            background-color: #cce7ff;
            color: #0056b3;
        }
        
        .progress-step.completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .progress-step i {
            margin-right: 0.5rem;
            width: 16px;
        }
        
        .form-text {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .modal-lg {
            max-width: 800px;
        }
    </style>
</head>
<body>
    <header class="phoenix-header sticky-top bg-white">
        <div class="container-fluid">
            <div class="row align-items-center py-2">
                <div class="col-auto">
                    <a href="{{ url_for('index') }}" class="phoenix-brand text-decoration-none">
                        <i class="fas fa-brain me-2 text-primary"></i>
                        <span class="fw-bold text-dark">Phoenix AI</span>
                    </a>
                </div>
                <div class="col"></div>
                <div class="col-auto">
                    {% if session.get('user_id') %}
                        <div class="dropdown">
                            <button class="btn btn-outline-primary btn-sm dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown">
                                {% if session.get('user_picture') %}
                                    <img src="{{ session.get('user_picture') }}" alt="User" class="rounded-circle me-2" style="width: 24px; height: 24px;">
                                {% else %}
                                    <i class="fas fa-user-circle me-2"></i>
                                {% endif %}
                                <span class="d-none d-md-inline">{{ session.get('user_name') or session.get('user_email', 'User') }}</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="{{ url_for('auth.profile') }}"><i class="fas fa-user me-2"></i>Profile</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('subscription.manage') }}"><i class="fas fa-credit-card me-2"></i>Subscription</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('dashboard_page') }}"><i class="fas fa-chart-bar me-2"></i>Dashboard</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('index') }}"><i class="fas fa-home me-2"></i>Home</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                            </ul>
                        </div>
                    {% else %}
                        <div class="auth-buttons">
                            <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary btn-sm me-2">Log In</a>
                            <a href="{{ url_for('auth.signup') }}" class="btn btn-primary btn-sm">Sign Up</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="dashboard-sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">My Dashboards</h1>
                <p class="sidebar-subtitle">Create and manage your dashboards</p>
            </div>
            
            <div class="back-btn">
                <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-arrow-left me-2"></i>Back to Profile
                </a>
            </div>
            
            <ul class="dashboard-list" id="dashboardList">
                <!-- Dashboards will be loaded dynamically -->
                <li class="dashboard-item">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted">Loading your dashboards...</p>
                    </div>
                </li>
                
                <li class="dashboard-item">
                    <a href="#" class="dashboard-link" data-dashboard="marketing">
                        <div>
                            <i class="fas fa-bullhorn dashboard-icon"></i>
                            <div class="dashboard-name">Marketing Metrics</div>
                            <div class="dashboard-desc">Campaign performance and ROI analysis</div>
                            <div class="dashboard-meta">Created 5 days ago • 24 views</div>
                        </div>
                    </a>
                </li>
                
                <li class="dashboard-item">
                    <a href="#" class="dashboard-link" data-dashboard="website">
                        <div>
                            <i class="fas fa-globe dashboard-icon"></i>
                            <div class="dashboard-name">Website Traffic</div>
                            <div class="dashboard-desc">Visitor analytics and user behavior</div>
                            <div class="dashboard-meta">Created 1 week ago • 45 views</div>
                        </div>
                    </a>
                </li>
                
                <li class="dashboard-item">
                    <a href="#" class="dashboard-link" data-dashboard="finance">
                        <div>
                            <i class="fas fa-dollar-sign dashboard-icon"></i>
                            <div class="dashboard-name">Financial Overview</div>
                            <div class="dashboard-desc">Revenue, expenses, and profit tracking</div>
                            <div class="dashboard-meta">Created 2 weeks ago • 67 views</div>
                        </div>
                    </a>
                </li>
                
                <li class="dashboard-item">
                    <div class="dashboard-link" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-plus-circle dashboard-icon" style="font-size: 2rem; color: #6c757d;"></i>
                        <div class="dashboard-name">No dashboards yet</div>
                        <div class="dashboard-desc">Click the + button to create your first dashboard</div>
                    </div>
                </li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="dashboard-main">
            <div class="main-header">
                <h1 class="main-title" id="dashboard-title">Sales Analytics</h1>
                <p class="main-subtitle" id="dashboard-subtitle">Monthly sales performance and trends</p>
            </div>
            
            <div class="dashboard-content">
                <!-- Metrics Grid -->
                <div class="metrics-grid" id="metrics-container">
                    <div class="metric-card">
                        <div class="metric-value">$245.8K</div>
                        <div class="metric-label">Total Revenue</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">1,247</div>
                        <div class="metric-label">Total Orders</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">$197.2</div>
                        <div class="metric-label">Avg Order Value</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">12.5%</div>
                        <div class="metric-label">Growth Rate</div>
                    </div>
                </div>
                
                <!-- Chart Container -->
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
                
                <!-- Additional Chart -->
                <div class="chart-container">
                    <canvas id="secondaryChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create New Dashboard Button -->
    <button class="create-btn" title="Create New Dashboard" data-bs-toggle="modal" data-bs-target="#createDashboardModal">
        <i class="fas fa-plus"></i>
    </button>
    
    <!-- Create Dashboard Modal -->
    <div class="modal fade" id="createDashboardModal" tabindex="-1" aria-labelledby="createDashboardModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createDashboardModalLabel">
                        <i class="fas fa-chart-bar me-2"></i>Create New Dashboard
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="step1" class="creation-step active">
                        <h6 class="mb-3">Describe Your Dashboard</h6>
                        <p class="text-muted mb-3">Tell us what kind of dashboard you want to create. Be as specific as possible about the data, metrics, and insights you're looking for.</p>
                        
                        <div class="mb-3">
                            <label for="dashboardQuery" class="form-label">What would you like to analyze?</label>
                            <textarea 
                                class="form-control" 
                                id="dashboardQuery" 
                                rows="4" 
                                placeholder="Example: I want to analyze global climate change trends over the past 20 years, focusing on temperature variations, CO2 levels, and their correlation with renewable energy adoption..."
                            ></textarea>
                            <div class="form-text">
                                <strong>Examples:</strong><br>
                                • Stock market performance and economic indicators<br>
                                • Social media trends and engagement metrics<br>
                                • Healthcare data and disease patterns<br>
                                • E-commerce sales and customer behavior
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dashboardName" class="form-label">Dashboard Name</label>
                            <input type="text" class="form-control" id="dashboardName" placeholder="e.g., Climate Change Analysis">
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <label for="preferredSources" class="form-label">Preferred Data Sources (Optional)</label>
                                <select class="form-select" id="preferredSources" multiple>
                                    <option value="kaggle">Kaggle Datasets</option>
                                    <option value="google-dataset">Google Dataset Search</option>
                                    <option value="world-bank">World Bank Open Data</option>
                                    <option value="who">WHO Global Health Observatory</option>
                                    <option value="fred">Federal Reserve Economic Data</option>
                                    <option value="census">US Census Bureau</option>
                                    <option value="eurostat">Eurostat</option>
                                    <option value="github">GitHub Repositories</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="visualizationType" class="form-label">Preferred Visualizations</label>
                                <select class="form-select" id="visualizationType" multiple>
                                    <option value="line-charts">Line Charts (Trends)</option>
                                    <option value="bar-charts">Bar Charts (Comparisons)</option>
                                    <option value="scatter-plots">Scatter Plots (Correlations)</option>
                                    <option value="heatmaps">Heatmaps (Patterns)</option>
                                    <option value="geographic">Geographic Maps</option>
                                    <option value="interactive">Interactive Dashboards</option>
                                    <option value="tensorboard">TensorBoard Style</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="step2" class="creation-step">
                        <h6 class="mb-3">
                            <i class="fas fa-search me-2"></i>Searching for Datasets...
                        </h6>
                        <div class="text-center mb-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3 text-muted">Our AI is searching for relevant datasets across trusted sources...</p>
                        </div>
                        <div class="progress mb-3">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div id="searchProgress">
                            <div class="search-status">
                                <i class="fas fa-hourglass-start me-2"></i>Analyzing your query...
                            </div>
                        </div>
                    </div>
                    
                    <div id="step3" class="creation-step">
                        <h6 class="mb-3">
                            <i class="fas fa-database me-2"></i>Found Datasets
                        </h6>
                        <p class="text-muted mb-3">Review the datasets our AI found for your dashboard:</p>
                        
                        <div id="datasetResults" class="dataset-list">
                            <!-- Dataset results will be populated here -->
                        </div>
                        
                        <div class="mt-3">
                            <small class="text-muted">Select the datasets you want to include in your dashboard</small>
                        </div>
                    </div>
                    
                    <div id="step4" class="creation-step">
                        <h6 class="mb-3">
                            <i class="fas fa-cogs me-2"></i>Creating Your Dashboard...
                        </h6>
                        <div class="text-center mb-4">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3 text-muted">Processing datasets and generating visualizations...</p>
                        </div>
                        <div class="creation-progress">
                            <div class="progress-step completed">
                                <i class="fas fa-check-circle"></i> Datasets downloaded to GCS
                            </div>
                            <div class="progress-step active">
                                <i class="fas fa-spinner fa-spin"></i> Analyzing data structure
                            </div>
                            <div class="progress-step">
                                <i class="fas fa-chart-bar"></i> Generating visualizations
                            </div>
                            <div class="progress-step">
                                <i class="fas fa-rocket"></i> Dashboard ready!
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                        <i class="fas fa-search me-2"></i>Find Datasets
                    </button>
                    <button type="button" class="btn btn-success" id="createBtn" onclick="createDashboard()" style="display: none;">
                        <i class="fas fa-plus me-2"></i>Create Dashboard
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dashboard data
        const dashboardData = {
            sales: {
                title: 'Sales Analytics',
                subtitle: 'Monthly sales performance and trends',
                metrics: [
                    { value: '$245.8K', label: 'Total Revenue' },
                    { value: '1,247', label: 'Total Orders' },
                    { value: '$197.2', label: 'Avg Order Value' },
                    { value: '12.5%', label: 'Growth Rate' }
                ],
                chart1: {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Revenue',
                            data: [35000, 42000, 38000, 51000, 47000, 55000],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.4
                        }]
                    }
                },
                chart2: {
                    type: 'bar',
                    data: {
                        labels: ['Product A', 'Product B', 'Product C', 'Product D'],
                        datasets: [{
                            label: 'Sales',
                            data: [120, 95, 78, 156],
                            backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545']
                        }]
                    }
                }
            },
            marketing: {
                title: 'Marketing Metrics',
                subtitle: 'Campaign performance and ROI analysis',
                metrics: [
                    { value: '45.2%', label: 'CTR' },
                    { value: '$2.34', label: 'CPC' },
                    { value: '8.7%', label: 'Conversion Rate' },
                    { value: '340%', label: 'ROAS' }
                ],
                chart1: {
                    type: 'doughnut',
                    data: {
                        labels: ['Google Ads', 'Facebook', 'Instagram', 'LinkedIn'],
                        datasets: [{
                            data: [35, 25, 20, 20],
                            backgroundColor: ['#007bff', '#1877f2', '#e4405f', '#0077b5']
                        }]
                    }
                },
                chart2: {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Impressions',
                            data: [12000, 15000, 18000, 22000],
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)'
                        }]
                    }
                }
            },
            website: {
                title: 'Website Traffic',
                subtitle: 'Visitor analytics and user behavior',
                metrics: [
                    { value: '25.4K', label: 'Page Views' },
                    { value: '8.2K', label: 'Unique Visitors' },
                    { value: '3.2', label: 'Pages/Session' },
                    { value: '2:45', label: 'Avg Session' }
                ],
                chart1: {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Visitors',
                            data: [1200, 1900, 3000, 5000, 2000, 3000, 2500],
                            borderColor: '#ffc107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)'
                        }]
                    }
                },
                chart2: {
                    type: 'bar',
                    data: {
                        labels: ['Desktop', 'Mobile', 'Tablet'],
                        datasets: [{
                            label: 'Device Usage',
                            data: [65, 30, 5],
                            backgroundColor: ['#007bff', '#28a745', '#dc3545']
                        }]
                    }
                }
            },
            finance: {
                title: 'Financial Overview',
                subtitle: 'Revenue, expenses, and profit tracking',
                metrics: [
                    { value: '$180.5K', label: 'Revenue' },
                    { value: '$120.2K', label: 'Expenses' },
                    { value: '$60.3K', label: 'Profit' },
                    { value: '33.4%', label: 'Margin' }
                ],
                chart1: {
                    type: 'bar',
                    data: {
                        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                        datasets: [{
                            label: 'Revenue',
                            data: [45000, 52000, 48000, 55000],
                            backgroundColor: '#28a745'
                        }, {
                            label: 'Expenses',
                            data: [30000, 35000, 32000, 38000],
                            backgroundColor: '#dc3545'
                        }]
                    }
                },
                chart2: {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Cash Flow',
                            data: [15000, 17000, 16000, 20000, 18000, 22000],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)'
                        }]
                    }
                }
            },
            social: {
                title: 'Social Media',
                subtitle: 'Engagement and follower growth',
                metrics: [
                    { value: '12.8K', label: 'Followers' },
                    { value: '4.2%', label: 'Engagement Rate' },
                    { value: '892', label: 'Likes' },
                    { value: '156', label: 'Shares' }
                ],
                chart1: {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Followers',
                            data: [8000, 8500, 9200, 10100, 11500, 12800],
                            borderColor: '#e4405f',
                            backgroundColor: 'rgba(228, 64, 95, 0.1)'
                        }]
                    }
                },
                chart2: {
                    type: 'doughnut',
                    data: {
                        labels: ['Instagram', 'Twitter', 'Facebook', 'LinkedIn'],
                        datasets: [{
                            data: [40, 25, 20, 15],
                            backgroundColor: ['#e4405f', '#1da1f2', '#1877f2', '#0077b5']
                        }]
                    }
                }
            },
            inventory: {
                title: 'Inventory Status',
                subtitle: 'Stock levels and product availability',
                metrics: [
                    { value: '2,456', label: 'Total Items' },
                    { value: '89', label: 'Low Stock' },
                    { value: '12', label: 'Out of Stock' },
                    { value: '95.2%', label: 'Availability' }
                ],
                chart1: {
                    type: 'bar',
                    data: {
                        labels: ['Electronics', 'Clothing', 'Books', 'Home & Garden'],
                        datasets: [{
                            label: 'Stock Level',
                            data: [450, 780, 320, 650],
                            backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545']
                        }]
                    }
                },
                chart2: {
                    type: 'pie',
                    data: {
                        labels: ['In Stock', 'Low Stock', 'Out of Stock'],
                        datasets: [{
                            data: [85, 12, 3],
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                        }]
                    }
                }
            }
        };
        
        let mainChart, secondaryChart;
        
        // Initialize charts
        function initCharts() {
            const ctx1 = document.getElementById('mainChart').getContext('2d');
            const ctx2 = document.getElementById('secondaryChart').getContext('2d');
            
            mainChart = new Chart(ctx1, {
                type: 'line',
                data: dashboardData.sales.chart1.data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
            
            secondaryChart = new Chart(ctx2, {
                type: 'bar',
                data: dashboardData.sales.chart2.data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }
        
        // Update dashboard content
        function updateDashboard(dashboardKey) {
            const data = dashboardData[dashboardKey];
            
            // Update title and subtitle
            document.getElementById('dashboard-title').textContent = data.title;
            document.getElementById('dashboard-subtitle').textContent = data.subtitle;
            
            // Update metrics
            const metricsContainer = document.getElementById('metrics-container');
            metricsContainer.innerHTML = '';
            
            data.metrics.forEach(metric => {
                const metricCard = document.createElement('div');
                metricCard.className = 'metric-card';
                metricCard.innerHTML = `
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                `;
                metricsContainer.appendChild(metricCard);
            });
            
            // Update charts
            if (mainChart) {
                mainChart.destroy();
            }
            if (secondaryChart) {
                secondaryChart.destroy();
            }
            
            const ctx1 = document.getElementById('mainChart').getContext('2d');
            const ctx2 = document.getElementById('secondaryChart').getContext('2d');
            
            mainChart = new Chart(ctx1, {
                type: data.chart1.type,
                data: data.chart1.data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
            
            secondaryChart = new Chart(ctx2, {
                type: data.chart2.type,
                data: data.chart2.data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }
        
        // Handle dashboard selection
        document.addEventListener('DOMContentLoaded', function() {
            loadUserDashboards();
            
            // Handle create button click
            document.querySelector('.create-btn').addEventListener('click', function() {
                // Reset modal to step 1
                resetModal();
            });
        });
        
        // Load user's dashboards from API
        async function loadUserDashboards() {
            try {
                const response = await fetch('/api/dashboards');
                if (response.ok) {
                    const data = await response.json();
                    renderDashboardList(data.dashboards);
                    if (data.dashboards.length > 0) {
                        // Load first dashboard by default
                        loadDashboardPreview(data.dashboards[0].id);
                    }
                } else {
                    showEmptyState();
                }
            } catch (error) {
                console.error('Error loading dashboards:', error);
                showEmptyState();
            }
        }
        
        // Render dashboard list in sidebar
        function renderDashboardList(dashboards) {
            const container = document.getElementById('dashboardList');
            container.innerHTML = '';
            
            if (dashboards.length === 0) {
                showEmptyState();
                return;
            }
            
            dashboards.forEach((dashboard, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'dashboard-item';
                
                const link = document.createElement('a');
                link.href = `/dashboard/${dashboard.id}`;
                link.className = `dashboard-link ${index === 0 ? 'active' : ''}`;
                link.setAttribute('data-dashboard-id', dashboard.id);
                
                link.innerHTML = `
                    <div>
                        <i class="${getDashboardIcon(dashboard.type)} dashboard-icon"></i>
                        <div class="dashboard-name">${dashboard.title}</div>
                        <div class="dashboard-desc">${dashboard.description || 'No description'}</div>
                        <div class="dashboard-meta">
                            Created ${formatRelativeTime(dashboard.created_at)} • ${dashboard.view_count || 0} views
                            ${dashboard.is_public ? ' • <i class="fas fa-globe" title="Public"></i>' : ''}
                        </div>
                    </div>
                `;
                
                // Add click handler for preview (prevent default navigation)
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active state
                    document.querySelectorAll('.dashboard-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Load dashboard preview
                    loadDashboardPreview(dashboard.id);
                });
                
                listItem.appendChild(link);
                container.appendChild(listItem);
            });
        }
        
        // Show empty state when no dashboards
        function showEmptyState() {
            const container = document.getElementById('dashboardList');
            container.innerHTML = `
                <li class="dashboard-item">
                    <div class="dashboard-link" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-plus-circle dashboard-icon" style="font-size: 2rem; color: #6c757d;"></i>
                        <div class="dashboard-name">No dashboards yet</div>
                        <div class="dashboard-desc">Click the + button to create your first dashboard</div>
                    </div>
                </li>
            `;
            
            // Show empty state in main content
            document.getElementById('dashboard-title').textContent = 'No Dashboard Selected';
            document.getElementById('dashboard-subtitle').textContent = 'Create your first dashboard to get started';
            document.getElementById('metrics-container').innerHTML = '';
            document.getElementById('mainChart').style.display = 'none';
            document.getElementById('secondaryChart').style.display = 'none';
        }
        
        // Load dashboard preview in main content
        async function loadDashboardPreview(dashboardId) {
            try {
                const response = await fetch(`/api/dashboards/${dashboardId}`);
                if (response.ok) {
                    const dashboard = await response.json();
                    renderDashboardPreview(dashboard);
                }
            } catch (error) {
                console.error('Error loading dashboard preview:', error);
            }
        }
        
        // Render dashboard preview
        function renderDashboardPreview(dashboard) {
            // Update header
            document.getElementById('dashboard-title').textContent = dashboard.title;
            document.getElementById('dashboard-subtitle').textContent = dashboard.description || 'No description';
            
            // Show preview message
            const metricsContainer = document.getElementById('metrics-container');
            metricsContainer.innerHTML = `
                <div class="col-12">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Dashboard Preview</strong><br>
                        This is a preview of "${dashboard.title}". 
                        <a href="/dashboard/${dashboard.id}" class="alert-link">Click here to view the full dashboard</a> 
                        with all interactive features.
                    </div>
                </div>
            `;
            
            // Hide charts for now (will be replaced with actual preview)
            document.getElementById('mainChart').style.display = 'none';
            document.getElementById('secondaryChart').style.display = 'none';
        }
        
        // Utility functions
        function getDashboardIcon(type) {
            const icons = {
                'analytics': 'fas fa-chart-line',
                'sales': 'fas fa-dollar-sign',
                'marketing': 'fas fa-bullhorn',
                'finance': 'fas fa-coins',
                'social': 'fas fa-share-alt',
                'website': 'fas fa-globe',
                'inventory': 'fas fa-boxes'
            };
            return icons[type] || 'fas fa-chart-bar';
        }
        
        function formatRelativeTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'today';
            if (diffDays === 1) return '1 day ago';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} week${Math.floor(diffDays / 7) > 1 ? 's' : ''} ago`;
            return `${Math.floor(diffDays / 30)} month${Math.floor(diffDays / 30) > 1 ? 's' : ''} ago`;
        }
        
        let currentStep = 1;
        const totalSteps = 4;
        
        // Mock dataset search function (will be replaced with actual API call)
        function searchDatasets(query, sources, visualizations) {
            return new Promise((resolve) => {
                // Simulate API delay
                setTimeout(() => {
                    const mockDatasets = [
                        {
                            title: "Global Temperature Anomalies Dataset",
                            source: "NOAA Climate Data",
                            description: "Historical temperature data from 1880-2023 showing global temperature anomalies and trends.",
                            size: "45 MB",
                            format: "CSV",
                            lastUpdated: "2024-01-15",
                            url: "https://example.com/dataset1"
                        },
                        {
                            title: "CO2 Emissions by Country",
                            source: "World Bank Open Data",
                            description: "Annual CO2 emissions data by country from 1960-2022, including per capita calculations.",
                            size: "12 MB",
                            format: "JSON",
                            lastUpdated: "2023-12-01",
                            url: "https://example.com/dataset2"
                        },
                        {
                            title: "Renewable Energy Statistics",
                            source: "International Energy Agency",
                            description: "Global renewable energy capacity, generation, and investment data by technology and region.",
                            size: "28 MB",
                            format: "CSV",
                            lastUpdated: "2024-02-10",
                            url: "https://example.com/dataset3"
                        }
                    ];
                    resolve(mockDatasets);
                }, 3000);
            });
        }
        
        function resetModal() {
            currentStep = 1;
            document.querySelectorAll('.creation-step').forEach(step => step.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.getElementById('nextBtn').style.display = 'inline-block';
            document.getElementById('createBtn').style.display = 'none';
            document.getElementById('nextBtn').innerHTML = '<i class="fas fa-search me-2"></i>Find Datasets';
            
            // Clear form
            document.getElementById('dashboardQuery').value = '';
            document.getElementById('dashboardName').value = '';
            document.getElementById('datasetResults').innerHTML = '';
        }
        
        async function nextStep() {
            if (currentStep === 1) {
                // Validate form
                const query = document.getElementById('dashboardQuery').value.trim();
                const name = document.getElementById('dashboardName').value.trim();
                
                if (!query || !name) {
                    alert('Please fill in both the dashboard description and name.');
                    return;
                }
                
                // Move to step 2 (searching)
                currentStep = 2;
                document.querySelectorAll('.creation-step').forEach(step => step.classList.remove('active'));
                document.getElementById('step2').classList.add('active');
                document.getElementById('nextBtn').style.display = 'none';
                
                // Simulate search progress
                const progressBar = document.querySelector('.progress-bar');
                const searchProgress = document.getElementById('searchProgress');
                
                const searchSteps = [
                    { progress: 20, text: '<i class="fas fa-brain me-2"></i>Analyzing your query...' },
                    { progress: 40, text: '<i class="fas fa-search me-2"></i>Searching Kaggle datasets...' },
                    { progress: 60, text: '<i class="fas fa-search me-2"></i>Searching Google Dataset Search...' },
                    { progress: 80, text: '<i class="fas fa-search me-2"></i>Searching government data sources...' },
                    { progress: 100, text: '<i class="fas fa-check-circle me-2"></i>Search completed!' }
                ];
                
                for (let i = 0; i < searchSteps.length; i++) {
                    await new Promise(resolve => setTimeout(resolve, 600));
                    progressBar.style.width = searchSteps[i].progress + '%';
                    
                    const statusDiv = document.createElement('div');
                    statusDiv.className = 'search-status';
                    if (i === searchSteps.length - 1) statusDiv.classList.add('completed');
                    statusDiv.innerHTML = searchSteps[i].text;
                    searchProgress.appendChild(statusDiv);
                }
                
                // Search for datasets
                const sources = Array.from(document.getElementById('preferredSources').selectedOptions).map(option => option.value);
                const visualizations = Array.from(document.getElementById('visualizationType').selectedOptions).map(option => option.value);
                
                try {
                    const datasets = await searchDatasets(query, sources, visualizations);
                    displayDatasets(datasets);
                    
                    // Move to step 3
                    currentStep = 3;
                    document.querySelectorAll('.creation-step').forEach(step => step.classList.remove('active'));
                    document.getElementById('step3').classList.add('active');
                    document.getElementById('nextBtn').style.display = 'inline-block';
                    document.getElementById('nextBtn').innerHTML = '<i class="fas fa-arrow-right me-2"></i>Continue';
                } catch (error) {
                    alert('Error searching for datasets. Please try again.');
                    resetModal();
                }
                
            } else if (currentStep === 3) {
                // Check if at least one dataset is selected
                const selectedDatasets = document.querySelectorAll('.dataset-checkbox input:checked');
                if (selectedDatasets.length === 0) {
                    alert('Please select at least one dataset to continue.');
                    return;
                }
                
                // Move to step 4 (creating dashboard)
                currentStep = 4;
                document.querySelectorAll('.creation-step').forEach(step => step.classList.remove('active'));
                document.getElementById('step4').classList.add('active');
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('createBtn').style.display = 'inline-block';
                
                // Simulate dashboard creation progress
                await simulateDashboardCreation();
            }
        }
        
        function displayDatasets(datasets) {
            const container = document.getElementById('datasetResults');
            container.innerHTML = '';
            
            datasets.forEach((dataset, index) => {
                const datasetDiv = document.createElement('div');
                datasetDiv.className = 'dataset-item';
                datasetDiv.innerHTML = `
                    <div class="dataset-checkbox">
                        <input type="checkbox" class="form-check-input" id="dataset-${index}" ${index === 0 ? 'checked' : ''}>
                    </div>
                    <div class="dataset-title">${dataset.title}</div>
                    <div class="dataset-source">${dataset.source}</div>
                    <div class="dataset-description">${dataset.description}</div>
                    <div class="dataset-meta">
                        <span class="me-3"><i class="fas fa-database me-1"></i>${dataset.size}</span>
                        <span class="me-3"><i class="fas fa-file me-1"></i>${dataset.format}</span>
                        <span><i class="fas fa-calendar me-1"></i>Updated: ${dataset.lastUpdated}</span>
                    </div>
                `;
                
                // Add click handler to toggle selection
                datasetDiv.addEventListener('click', function(e) {
                    if (e.target.type !== 'checkbox') {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                    }
                    this.classList.toggle('selected', this.querySelector('input[type="checkbox"]').checked);
                });
                
                // Set initial selection state
                if (index === 0) {
                    datasetDiv.classList.add('selected');
                }
                
                container.appendChild(datasetDiv);
            });
        }
        
        async function simulateDashboardCreation() {
            const steps = document.querySelectorAll('.progress-step');
            
            for (let i = 0; i < steps.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 1500));
                steps[i].classList.remove('active');
                steps[i].classList.add('completed');
                steps[i].querySelector('i').className = 'fas fa-check-circle';
                
                if (i < steps.length - 1) {
                    steps[i + 1].classList.add('active');
                }
            }
            
            // Update create button
            document.getElementById('createBtn').innerHTML = '<i class="fas fa-check me-2"></i>Dashboard Created!';
            document.getElementById('createBtn').classList.remove('btn-success');
            document.getElementById('createBtn').classList.add('btn-primary');
        }
        
        function createDashboard() {
            // Close modal and refresh page to show new dashboard
            const modal = bootstrap.Modal.getInstance(document.getElementById('createDashboardModal'));
            modal.hide();
            
            // Show success message
            setTimeout(() => {
                alert('Dashboard created successfully! It will appear in your dashboard list.');
                // In a real implementation, you would refresh the dashboard list or redirect
            }, 500);
        }
    </script>
</body>
</html>
