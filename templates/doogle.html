{% extends "base.html" %}

{% block title %}Doogle{% endblock %}

{% block header %}
{% if query %}
<!-- Custom header for search results -->
<header class="doogle-header">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-auto">
                <a href="{{ url_for('index') }}" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <div class="doogle-logo">
                    <a href="{{ url_for('doogle') }}" style="text-decoration: none;">
                        <span>D</span><span>o</span><span>o</span><span>g</span><span>l</span><span>e</span>
                    </a>
                </div>
            </div>
            
            <div class="col">
                <form class="doogle-search-form" id="search-form" action="{{ url_for('doogle') }}" method="get">
                    <div class="search-input-container">
                        <i class="fas fa-search search-icon"></i>
                        <input 
                            type="text" 
                            class="search-input" 
                            id="search-input" 
                            name="q" 
                            value="{{ query }}" 
                            placeholder="Search Doogle..."
                            autocomplete="off"
                        >
                        <input type="hidden" name="category" value="{{ category }}" id="category-input">
                    </div>
                </form>
            </div>
            
            <div class="col-auto">
                <button type="submit" form="search-form" class="btn btn-primary">Search</button>
                
                <!-- User Status -->
                {% if session.get('user_id') %}
                    <div class="dropdown d-inline-block ms-2">
                        <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            {% if session.get('user_picture') %}
                                <img src="{{ session.get('user_picture') }}" alt="User" class="user-avatar-tiny">
                            {% else %}
                                <i class="fas fa-user"></i>
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><div class="dropdown-header">
                                <strong>{{ session.get('user_name') or session.get('user_email', 'User') }}</strong>
                                {% if subscription and subscription.is_premium %}
                                    <div class="small"><span class="badge bg-gradient-premium">Premium</span></div>
                                {% endif %}
                            </div></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('profile') }}">
                                <i class="fas fa-user me-2"></i>Profile
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('index') }}">
                                <i class="fas fa-home me-2"></i>Home
                            </a></li>
                        </ul>
                    </div>
                {% else %}
                    <div class="auth-buttons-small ms-2">
                        <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary btn-sm">Login</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</header>
{% else %}
<!-- Use standard header for homepage -->
{{ super() }}
{% endif %}
{% endblock %}

{% block main_class %}{% if query %}doogle-results{% else %}doogle-homepage{% endif %}{% endblock %}

{% block content %}
{% if query %}
    <!-- Search Results -->
    <div class="container py-4">
        <div class="search-category-tabs">
            <button class="category-tab {% if category == 'web' %}active{% endif %}" onclick="switchCategory('web')">
                <i class="fas fa-globe"></i> Web
            </button>
            <button class="category-tab {% if category == 'news' %}active{% endif %}" onclick="switchCategory('news')">
                <i class="fas fa-newspaper"></i> News
            </button>
        </div>

        {% if results.error %}
            <div class="alert alert-danger mt-3">
                <i class="fas fa-exclamation-triangle"></i>
                {{ results.error }}
            </div>
        {% elif results.results %}
            <div class="search-results-info">
                About {{ results.total_results }} results ({{ "%.2f" | format(results.search_time) }} seconds)
            </div>

            <div class="search-results">
                {% for result in results.results %}
                    <div class="search-result">
                        <div class="result-url">{{ result.display_url or result.url }}</div>
                        <h3><a href="{{ result.url }}" class="result-title" target="_blank">{{ result.title }}</a></h3>
                        <p class="result-description">{{ result.description }}</p>
                        
                        {% if result.ai_summary %}
                        <div class="ai-summary">
                            <div class="ai-summary-header">
                                <i class="fas fa-robot"></i> AI Summary
                            </div>
                            <div class="ai-summary-content">{{ result.ai_summary }}</div>
                        </div>
                        {% endif %}

                        <div class="result-meta">
                            {% if result.published_date %}
                                <span><i class="far fa-clock"></i> {{ result.published_date }}</span>
                            {% endif %}
                            {% if result.source %}
                                <span class="ms-3"><i class="fas fa-external-link-alt"></i> {{ result.source }}</span>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if results.pagination %}
            <nav aria-label="Search results pagination" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if results.pagination.prev_page %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('doogle', q=query, category=category, page=results.pagination.prev_page) }}">Previous</a>
                        </li>
                    {% endif %}
                    
                    {% for page_num in results.pagination.page_numbers %}
                        <li class="page-item {% if page_num == results.pagination.current_page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('doogle', q=query, category=category, page=page_num) }}">{{ page_num }}</a>
                        </li>
                    {% endfor %}
                    
                    {% if results.pagination.next_page %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('doogle', q=query, category=category, page=results.pagination.next_page) }}">Next</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        {% else %}
            <div class="no-results">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <h3>No results found</h3>
                <p>Try different keywords or check your spelling</p>
            </div>
        {% endif %}
    </div>
{% else %}
    <!-- Homepage -->
    <div class="doogle-homepage-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="doogle-home-content text-center">
                        <div class="doogle-logo-large mb-4">
                            <span>D</span><span>o</span><span>o</span><span>g</span><span>l</span><span>e</span>
                        </div>
                        
                        <p class="lead mb-4">AI-powered search with smart summaries</p>
                        
                        <form action="{{ url_for('doogle') }}" method="get" class="doogle-home-search">
                            <div class="input-group input-group-lg">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" name="q" placeholder="Search the web..." autocomplete="off" autofocus>
                                <button class="btn btn-primary" type="submit">Search</button>
                            </div>
                        </form>
                        
                        <div class="search-suggestions mt-3">
                            <small class="text-muted">Try: "Latest AI news", "Python tutorials", "Weather forecast"</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    /* Doogle-specific styles */
    .doogle-header {
        background: white;
        border-bottom: 1px solid #e0e0e0;
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 1000;
    }
    
    .back-button {
        color: #555;
        text-decoration: none;
        margin-right: 1rem;
        font-size: 1.2rem;
    }
    
    .doogle-logo {
        font-size: 1.5rem;
        font-weight: bold;
        display: inline-block;
    }
    
    .doogle-logo span:nth-child(1) { color: #4285f4; }
    .doogle-logo span:nth-child(2) { color: #ea4335; }
    .doogle-logo span:nth-child(3) { color: #fbbc05; }
    .doogle-logo span:nth-child(4) { color: #4285f4; }
    .doogle-logo span:nth-child(5) { color: #34a853; }
    .doogle-logo span:nth-child(6) { color: #ea4335; }
    
    .doogle-logo-large {
        font-size: 4rem;
        font-weight: bold;
    }
    
    .doogle-logo-large span:nth-child(1) { color: #4285f4; }
    .doogle-logo-large span:nth-child(2) { color: #ea4335; }
    .doogle-logo-large span:nth-child(3) { color: #fbbc05; }
    .doogle-logo-large span:nth-child(4) { color: #4285f4; }
    .doogle-logo-large span:nth-child(5) { color: #34a853; }
    .doogle-logo-large span:nth-child(6) { color: #ea4335; }
    
    .search-input-container {
        position: relative;
        flex: 1;
        max-width: 500px;
    }
    
    .search-input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border: 1px solid #ddd;
        border-radius: 24px;
        font-size: 1rem;
        outline: none;
    }
    
    .search-input:focus {
        border-color: #4285f4;
        box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
    }
    
    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9aa0a6;
    }
    
    .doogle-homepage-container {
        min-height: 80vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .search-category-tabs {
        border-bottom: 1px solid #e0e0e0;
        margin-bottom: 1rem;
    }
    
    .category-tab {
        background: none;
        border: none;
        padding: 0.75rem 1rem;
        margin-right: 1rem;
        color: #70757a;
        border-bottom: 2px solid transparent;
        cursor: pointer;
    }
    
    .category-tab.active {
        color: #1a73e8;
        border-bottom-color: #1a73e8;
    }
    
    .search-results-info {
        color: #70757a;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
    
    .search-result {
        margin-bottom: 1.5rem;
        padding: 0.5rem;
        border-radius: 8px;
    }
    
    .result-url {
        color: #202124;
        font-size: 0.9rem;
        margin-bottom: 0.3rem;
    }
    
    .result-title {
        color: #1a0dab;
        font-size: 1.2rem;
        margin-bottom: 0.3rem;
        text-decoration: none;
    }
    
    .result-title:hover {
        text-decoration: underline;
    }
    
    .result-description {
        color: #4d5156;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    .ai-summary {
        background: #f8f9fa;
        border-left: 4px solid #4285f4;
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 0 4px 4px 0;
    }
    
    .ai-summary-header {
        font-weight: 600;
        color: #4285f4;
        margin-bottom: 0.5rem;
    }
    
    .result-meta {
        display: flex;
        align-items: center;
        margin-top: 0.3rem;
        color: #70757a;
        font-size: 0.85rem;
    }
    
    .no-results {
        text-align: center;
        padding: 3rem 0;
    }
    
    .user-avatar-tiny {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        object-fit: cover;
    }
    
    .bg-gradient-premium {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    @media (max-width: 768px) {
        .doogle-logo-large {
            font-size: 2.5rem;
        }
        
        .auth-buttons-small {
            display: none;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
function switchCategory(category) {
    const categoryInput = document.getElementById('category-input');
    if (categoryInput) {
        categoryInput.value = category;
        document.getElementById('search-form').submit();
    }
}

// Auto-focus search input on homepage
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.doogle-home-search input[name="q"]');
    if (searchInput) {
        searchInput.focus();
    }
});
</script>
{% endblock %}